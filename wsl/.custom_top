#! /bin/bash

trim_path() {
	# PATH
	PATH=$(echo "$PATH" | sed -e 's/\/mnt\/c\/Program Files\/nodejs://')
	PATH=$(echo "$PATH" | sed -e 's/\/mnt\/c\/Users\/Lenod\/AppData\/Roaming\/npm://')
	PATH=$(echo "$PATH" | sed -e 's/\/mnt\/c\/Program Files (x86)\/Yarn\/bin://')
}

if [[ ${OS} == "WSL2" ]] ; then
	if [[ -z "$LD_LIBRARY_PATH" ]]; then
		export LD_LIBRARY_PATH="/usr/lib/wsl/lib"
	elif [[ ":$LD_LIBRARY_PATH:" != *":/usr/lib/wsl/lib:"* ]]; then
		export LD_LIBRARY_PATH="/usr/lib/wsl/lib:$LD_LIBRARY_PATH"
	fi
	trim_path
fi

if [[ ${OS} == "WSL1" ]] ; then
	export LANG=zh_CN.UTF-8
	export LANGUAGE=zh_CN:en_US:en

	trim_path

	is_sshd_running=$(ps aux | grep sshd | grep -v grep)
	if [ -z "$is_sshd_running" ]; then
		sudo service ssh start > /dev/null
	fi
fi


if [ -e $HOME/.nix-profile/etc/profile.d/nix.sh ]; then . $HOME/.nix-profile/etc/profile.d/nix.sh; fi
