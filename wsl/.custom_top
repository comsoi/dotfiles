#! /bin/bash

trim_path() {
	# PATH
	PATH=$(echo "$PATH" | sed -e 's/\/mnt\/c\/Program Files\/nodejs://')
	PATH=$(echo "$PATH" | sed -e 's/\/mnt\/c\/Users\/Lenod\/AppData\/Roaming\/npm://')
	PATH=$(echo "$PATH" | sed -e 's/\/mnt\/c\/Program Files (x86)\/Yarn\/bin://')
}

alias cmd='cmd.exe'
alias powershell='powershell.exe'
alias pwsh='pwsh.exe'
alias nu='nu.exe'
alias wsl='wsl.exe'


if [[ ${OS} == "WSL2" ]] ; then
	if [[ -z "$LD_LIBRARY_PATH" ]]; then
		export LD_LIBRARY_PATH="/usr/lib/wsl/lib"
	elif [[ ":$LD_LIBRARY_PATH:" != *":/usr/lib/wsl/lib:"* ]]; then
		export LD_LIBRARY_PATH="/usr/lib/wsl/lib:$LD_LIBRARY_PATH"
	fi

	trim_path

    export HOST_COMPILER=/usr/bin/g++-13  # it works
    export CUDAHOSTCXX=/usr/bin/g++-13
    export NVCC_PREPEND_FLAGS='-ccbin /usr/bin/g++-13'
    PATH=/opt/cuda/bin:$PATH
    export PATH
fi

if [[ ${OS} == "WSL1" ]] ; then
	export LANG=zh_CN.UTF-8
	export LANGUAGE=zh_CN:en_US:en
	export DISPLAY=:0

	trim_path
    export PATH

	# ssh cannot be started until wsl has started
	is_sshd_running=$(ps aux | grep sshd | grep -v grep)
	if [ -z "$is_sshd_running" ]; then
		(sudo service ssh start > /dev/null)
	fi
fi

alias e.="explorer.exe ."
alias e="explorer.exe"

if [ -e $HOME/.nix-profile/etc/profile.d/nix.sh ]; then . $HOME/.nix-profile/etc/profile.d/nix.sh; fi
