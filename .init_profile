#! /bin/bash

# Set language environment
if [[ $(tty) == /dev/pts/* ]]; then
	export LANG=zh_CN.UTF-8
	export LANGUAGE=zh_CN:en_US:en
fi

export EDITOR='vim'
export LESS="-R"

append_env () {
	# $1: 环境变量名称（如 PATH）
	# $2: 要添加的值
	# $3: 可选，如果是 "prefix" 则添加到开头
	eval "case \":\$$1:\" in
		*:\"$2\":*)
			;;
		*)
			if [ \"\$3\" = \"prefix\" ]; then
				eval \"$1=$2\${$1:+:\$$1}\"
			else
				eval \"$1=\${$1:+\$$1:}$2\"
			fi
			;;
	esac"
}

append_env PATH "$HOME/.local/bin" prefix

# OS
{
	unameOut=$(uname -a)
	case "${unameOut}" in
		*Microsoft*)     OS="WSL1";; #wls must be first since it will have Linux in the name too
		*microsoft*)     OS="WSL2";;
		Linux*)     OS="Linux";;
		Darwin*)    OS="Mac";;
		CYGWIN*)    OS="Cygwin";;
		MINGW*)     OS="Windows";;
		*Msys)     OS="Windows";;
		*)          OS="UNKNOWN:${unameOut}"
	esac

	if [[ ${OS} == "Mac" ]] && sysctl -n machdep.cpu.brand_string | grep -q 'Apple M'; then
		# This check should work even if the current processes is running under x86 emulation.
		OS="MacArm"
	fi
	unset unameOut
	export OS
}

if [[ -r "${HOME}/.custom_top" ]]; then
	source ${HOME}/.custom_top
fi
